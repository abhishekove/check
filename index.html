<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>GeoAR.js demo</title>
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
</head>

<script>
    AFRAME.registerComponent('clickhandler', {
        init: function() {
            this.el.addEventListener('click', () => {
                // alert(this.el.attributes.name)
                const ee=this.el
                alert(ee.title);
                console.log(ee.title);
            });
    }});
</script>

<body style='margin: 0; overflow: hidden;'>
    <a-scene
        cursor='rayOrigin: mouse; fuse: true; fuseTimeout: 0;'
        raycaster="objects: [clickhandler];"
        vr-mode-ui="enabled: false"
		embedded
		arjs='sourceType: webcam; debugUIEnabled: false;'>

        <a-assets id="as" >
          <img id="my" src="mark.png" class="meee" cursor-list  alt="">
        </a-assets>

          <!-- <a-image
          look-at="[gps-camera]"
          clickhandler
          gps-entity-place="latitude: 19.027583; longitude: 73.101085;"
          src="#my"
          scale="10 10 10"
          id="lat"
          class="meee"
          ></a-image> -->
        <a-camera gps-camera rotation-reader>
		</a-camera>
	</a-scene>
  <script>

  window.onload = () => {
      let method = 'dynamic';
      var lattu;
      var longii;
      // if you want to statically add places, de-comment following line:
      method = 'static';

      function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  }
}

function showPosition(position) {
  // x.innerHTML = ;
   lattu=position.coords.latitude;
   longii=position.coords.longitude;
    alert('https://cors-anywhere.herokuapp.com/https://en.wikipedia.org/w/api.php?action=query&list=geosearch&gscoord='+lattu+'|'+longii+'&gsradius=10000&format=json')
}

      if (method === 'static') {
          let places = staticLoadPlaces();

          // console.log(places);
          getLocation()
          var req =new XMLHttpRequest();
      // req.open('GET','http://api.geonames.org/countryCodeJSON?lat=19.027583&lng=73.101085&username=abhishekove',false);
      //https://en.wikipedia.org/w/api.php?action=query&list=geosearch&gscoord=37.7891838%7C-122.4033522&gsradius=10000&gslimit=10
      req.open('GET','https://cors-anywhere.herokuapp.com/https://en.wikipedia.org/w/api.php?action=query&list=geosearch&gscoord='+lattu+'|'+longii+'&gsradius=10000&format=json',false);
      req.send(null);
      var dat=req.response
      dat=JSON.parse(dat)
      // console.log(dat.query.geosearch);
      places=dat.query.geosearch
      console.log(places);
          return renderPlaces(places);
      }

  };

  function staticLoadPlaces() {
      return [
          {
              name: "Kalamboli",
              location: {
                  lat: 19.027583, // change here latitude if using static data
                  lng: 73.101085, // change here longitude if using static data
              }
          },
          {
            name:"DMART",
            location:{
              lat:19.028241,
              lng:73.101462,
            }
          },
      ];
  }

  function renderPlaces(places) {
      let scene = document.querySelector('a-scene');

      places.forEach((place) => {
          let latitude = place.lat;
          let longitude = place.lon;

          // add place name
          let text = document.createElement('a-image');
          text.setAttribute('gps-entity-place', `latitude: ${latitude}; longitude: ${longitude};`);
          text.setAttribute('title', place.title);
          text.setAttribute('src', '#my');
          text.setAttribute('scale', '15 15 15');
          text.setAttribute('clickhandler','')
          text.addEventListener('loaded', () => {
              window.dispatchEvent(new CustomEvent('gps-entity-place-loaded', { detail: { component: this.el }}))
          });

          scene.appendChild(text);
      });
  }
  </script>
</body>
